{
  "comments": [
    {
      "key": {
        "uuid": "1a1963ec_aef2941c",
        "filename": "zuul/executor/client.py",
        "patchSetId": 15
      },
      "lineNbr": 153,
      "author": {
        "id": 1
      },
      "writtenOn": "2021-06-03T22:49:52Z",
      "side": 1,
      "message": "This is fine, but I wonder if we could move this logic into ExecutorApi.requestCancel ?",
      "revId": "fb2d693a3264c073abaa67295b335c12730f1de8",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "99edc83f_62db2d49",
        "filename": "zuul/executor/client.py",
        "patchSetId": 15
      },
      "lineNbr": 153,
      "author": {
        "id": 27952
      },
      "writtenOn": "2021-06-14T05:37:35Z",
      "side": 1,
      "message": "This should be possible, and sounds like a good idea. Do you want to do that or should I do?",
      "parentUuid": "1a1963ec_aef2941c",
      "revId": "fb2d693a3264c073abaa67295b335c12730f1de8",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a7171778_601a645c",
        "filename": "zuul/executor/client.py",
        "patchSetId": 15
      },
      "lineNbr": 153,
      "author": {
        "id": 27952
      },
      "writtenOn": "2021-06-14T05:52:52Z",
      "side": 1,
      "message": "Wait, on second look I think we should keep it like that: There is still the differentiation between requesting the cancel via the cancel subnode in ZK (ExecutorApi.requestCancel) in case the build is locked and to directly cancel the build via a BuildCompletedEvent in case it\u0027s not locked. The latter part requires access to the result event queue and I\u0027m not sure if we should add this to the ExecutorApi as it wouldn\u0027t be needed for anything else. In the current version we also need the local build object to access the tenant and pipeline name via the buildset and this is only available in the executor_client. But maybe we could make things a little more clear by splitting this up in two methods (like before with cancelRunningBuild and cancelJobInQueue), whereby acquiring the lock is the condition which method is executed.",
      "parentUuid": "99edc83f_62db2d49",
      "revId": "fb2d693a3264c073abaa67295b335c12730f1de8",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "14888e81_8daa9d91",
        "filename": "zuul/executor/client.py",
        "patchSetId": 15
      },
      "lineNbr": 153,
      "author": {
        "id": 1
      },
      "writtenOn": "2021-06-15T00:26:17Z",
      "side": 1,
      "message": "Makes sense.  I lean toward keeping this as one method for now; it\u0027s not too hard to follow.",
      "revId": "fb2d693a3264c073abaa67295b335c12730f1de8",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "6a0a5b86_bf93dfe0",
        "filename": "zuul/executor/server.py",
        "patchSetId": 15
      },
      "lineNbr": 2746,
      "author": {
        "id": 1
      },
      "writtenOn": "2021-06-03T22:49:52Z",
      "side": 1,
      "message": "I think I fixed this in another patch; I imagine this will clear out after the next reabse.",
      "revId": "fb2d693a3264c073abaa67295b335c12730f1de8",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "93d750b5_ab29c23f",
        "filename": "zuul/executor/server.py",
        "patchSetId": 15
      },
      "lineNbr": 3238,
      "author": {
        "id": 1
      },
      "writtenOn": "2021-06-03T22:49:52Z",
      "side": 1,
      "message": "-1: We need to run this frequently because it\u0027s the only way we\u0027re going to restart builds when an executor crashes.  But since that\u0027s the only case we need to handle, I think we could do it every 60 seconds.  It\u0027s okay if we have to wait a full minute in case an executor crashes.\n\nWe also need to move this to the scheduler, because it\u0027s doing work that applies to all zones, not just the ones this executor is subscribed to.  We\u0027ll have a full cache on the schedulers, but a smaller one on the executors.  Also, if all executors go offline, it would still be nice for the schedulers to clean the system up so it doesn\u0027t look like builds are still running.",
      "revId": "fb2d693a3264c073abaa67295b335c12730f1de8",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "2cf0633b_19fb1874",
        "filename": "zuul/executor/server.py",
        "patchSetId": 15
      },
      "lineNbr": 3238,
      "author": {
        "id": 1
      },
      "writtenOn": "2021-06-13T14:28:05Z",
      "side": 1,
      "message": "I implemented this in a followup.",
      "revId": "fb2d693a3264c073abaa67295b335c12730f1de8",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543",
      "unresolved": false
    }
  ]
}