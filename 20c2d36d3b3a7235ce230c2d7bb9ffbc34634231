{
  "comments": [
    {
      "key": {
        "uuid": "e7908d06_d7dbfa9b",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 15,
      "author": {
        "id": 1
      },
      "writtenOn": "2021-08-24T20:56:11Z",
      "side": 1,
      "message": "That might be a way to untangle the permanent vs temporary data confusion we have here (git dependencies are immutable aspects of a change(patchset); header dependencies are mutable, in that saying Depends-On: foo could mean foo patchset 1, or foo patchset 2 depending on when it was resolved).  Storing the mutable references on the change object always seemed awkward.\n\nBut maybe we can store only the immutable references on the change object, and then have the pipeline manager determine the mutable references and store the results (as cache keys, since we know this is going into ZK too) on queue items, then have the pipeline manager pull the actual change objects out of the cache from those keys as needed?",
      "revId": "20c2d36d3b3a7235ce230c2d7bb9ffbc34634231",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "abde10f5_521da25b",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 15,
      "author": {
        "id": 27582
      },
      "writtenOn": "2021-08-25T13:19:38Z",
      "side": 1,
      "message": "I think storing the mutable dependencies on the queue item might complicate things regarding the \"refresh_deps\" flag. Currently this is set in the onChangeUpdated() method of the scheduler by looping over the cached changes in all sources.\n\nIf the mutable needed changes are part of the queue item we can no longer access them from outside the run handler. I\u0027m not 100% sure about his, but it seems as if we\u0027d need to dispatch an event to all tenants/pipelines in order to refresh the dependencies. We could turn this around by making the pipeline manager check if the needed change is still up-to-date. But that could cause unnecessary access of the ZK change cache.",
      "parentUuid": "e7908d06_d7dbfa9b",
      "revId": "20c2d36d3b3a7235ce230c2d7bb9ffbc34634231",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543",
      "unresolved": false
    }
  ]
}