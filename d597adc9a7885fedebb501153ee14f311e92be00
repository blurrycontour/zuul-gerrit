{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "960ea19f_e99cce35",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 8
      },
      "lineNbr": 0,
      "author": {
        "id": 16068
      },
      "writtenOn": "2022-02-24T20:22:13Z",
      "side": 1,
      "message": "Implementation lgtm.\n\nHowever this will cause a lot more requests to the api/tenants endpoint. This currently is in zuul-web not optimized as it is uncached and iterates over all tenants and pipelines to gather queue statistics. Especially on large systems with many tenants and pipelines this can add significant extra load on zuul-web. Thus this needs to be optimized via caching similar to the status endpoint before we can merge this change.",
      "revId": "d597adc9a7885fedebb501153ee14f311e92be00",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "6e45de97_76a051f9",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 8
      },
      "lineNbr": 0,
      "author": {
        "id": 7186
      },
      "writtenOn": "2022-03-09T09:30:49Z",
      "side": 1,
      "message": "This is now rebased on top of 832293 which adds caching for the tenants endpoint.",
      "parentUuid": "960ea19f_e99cce35",
      "revId": "d597adc9a7885fedebb501153ee14f311e92be00",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "b25bd644_c159a455",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 8
      },
      "lineNbr": 0,
      "author": {
        "id": 27952
      },
      "writtenOn": "2022-03-16T06:49:01Z",
      "side": 1,
      "message": "Maybe we could enhance the /tenants endpoint to only provide the list of tenant names (by adding a get parameter like `names_only`) or add a new endpoint for this. Currently, the costly part of the /tenants endpoint is iterating over all pipelines to get the length of the queues (which iterates directly over the ZooKeeper data structure). However, for a functionality like this, the tenant names would be sufficient (which are looked up from the local abide object in zuul-web directly, so that doesn\u0027t involve any ZooKeeper operations).\n\nWith both in place (tenant names endpoint and tenant dropdown) we could further reduce the amount of requests to the tenants/ endpoint as a user doesn\u0027t need to visit the tenants page to simply switch tenants.",
      "parentUuid": "6e45de97_76a051f9",
      "revId": "d597adc9a7885fedebb501153ee14f311e92be00",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "fa8526ee_8b183bf3",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 8
      },
      "lineNbr": 0,
      "author": {
        "id": 7186
      },
      "writtenOn": "2022-03-16T09:31:24Z",
      "side": 1,
      "message": "That was my original plan, see: https://review.opendev.org/c/zuul/zuul/+/832258\n\nI liked the caching approach seen in this present patch because it had a minimal impact on the GUI, ie no need to handle cases in the redux engine when to use names_only or not, or to have a new entry in the redux store for tenants only. I\u0027d have to rework 810955 quite a bit if I were to rebase on top of 832258.\n\nWe could also handle caching at the GUI level, add an option to fetchTenantsIfNeeded to not call the API if tenants info is already in the store when invoked by the tenants dropdown component - if it is possible at all.\n\nThat\u0027s now 3 different approaches for this feature, so I\u0027d appreciate a definitive opinion before going further with it. :)",
      "parentUuid": "b25bd644_c159a455",
      "revId": "d597adc9a7885fedebb501153ee14f311e92be00",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543"
    }
  ]
}