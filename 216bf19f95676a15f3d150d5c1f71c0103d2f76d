{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "c6993d9b_3aa62ed4",
        "filename": "zuul/driver/zuul/__init__.py",
        "patchSetId": 2
      },
      "lineNbr": 139,
      "author": {
        "id": 4146
      },
      "writtenOn": "2022-02-23T21:56:32Z",
      "side": 1,
      "message": "Does it make sense to make this part of the ZuulTriggerEvent __init__ method then it will always have the value? Might make for a good followup to avoid this type of bug in the future.",
      "revId": "216bf19f95676a15f3d150d5c1f71c0103d2f76d",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "26d36264_47e911e9",
        "filename": "zuul/scheduler.py",
        "patchSetId": 2
      },
      "lineNbr": 1965,
      "author": {
        "id": 16068
      },
      "writtenOn": "2022-02-23T21:12:22Z",
      "side": 1,
      "message": "If the scheduler fails here or crashes it processed all the events but may not have processed the queue. So in those rare cases the pipeline may be stuck until there is an event for it. Do we want to cover this case or should we accept this risk?",
      "revId": "216bf19f95676a15f3d150d5c1f71c0103d2f76d",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "6e2811d2_7a2c12d5",
        "filename": "zuul/scheduler.py",
        "patchSetId": 2
      },
      "lineNbr": 1965,
      "author": {
        "id": 1
      },
      "writtenOn": "2022-02-23T21:34:07Z",
      "side": 1,
      "message": "I originally figured the risk was small and mitigated by the high probability another event would come along.  The alternative is to \"peek\" at the pipeline state (we already do that elsewhere to read the layout uuid), but I didn\u0027t want to keep doing that, especially inside a loop where we would likely immediately read the state again after peeking.  That\u0027s why I went with the event: to keep the number of things to check to a minimum.\n\nBut combined with the point below, perhaps we should address this situation generically.  We could write a flag znode indicating it\u0027s \"dirty\" when we start processing the pipeline, and then clear it below where we set STATE_NORMAL.  We\u0027ll add a check for the flag to the list of conditions where we process a pipeline.  If we hit either of these two situations, the flag will remain, and another scheduler can process it.",
      "revId": "216bf19f95676a15f3d150d5c1f71c0103d2f76d",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "8bc8f4a4_9841032a",
        "filename": "zuul/scheduler.py",
        "patchSetId": 2
      },
      "lineNbr": 1965,
      "author": {
        "id": 16068
      },
      "writtenOn": "2022-02-23T21:38:40Z",
      "side": 1,
      "message": "I just wanted to make sure that we thought about this case. I think the dirty flag is a good idea for an enhancement in a followup.",
      "parentUuid": "6e2811d2_7a2c12d5",
      "revId": "216bf19f95676a15f3d150d5c1f71c0103d2f76d",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e3881c46_84c0df74",
        "filename": "zuul/scheduler.py",
        "patchSetId": 2
      },
      "lineNbr": 1965,
      "author": {
        "id": 4146
      },
      "writtenOn": "2022-02-23T21:56:32Z",
      "side": 1,
      "message": "As noted on Matrix following up to make the dirty flag change is a good thing, but we can get away with this for now so approving as is.",
      "parentUuid": "8bc8f4a4_9841032a",
      "revId": "216bf19f95676a15f3d150d5c1f71c0103d2f76d",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5fe0c1a4_989a957c",
        "filename": "zuul/scheduler.py",
        "patchSetId": 2
      },
      "lineNbr": 1970,
      "author": {
        "id": 16068
      },
      "writtenOn": "2022-02-23T21:12:22Z",
      "side": 1,
      "message": "We may want to enqueue a PipelinePostConfigEvent here so the pipeline gets retried in the next loop.",
      "revId": "216bf19f95676a15f3d150d5c1f71c0103d2f76d",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543"
    }
  ]
}