- hosts: all
  roles:
    - revoke-sudo
    - set-zuul-log-path-fact
    - role: npm
      npm_command: >-
        build --
          --define "ZUUL_API_URL='{{ zuul_api_url }}'"
      zuul_work_dir: "{{ zuul.project.src_dir }}/web"
  post_tasks:
    - name: Copy the build to the javascript content dir
      command: "rsync -a --delete {{ zuul.project.src_dir }}/web/build/ {{ zuul.project.src_dir }}/zuul/web/static"
  environment:
    REACT_APP_ZUUL_API_ROOT: "{{ zuul_api_url }}/api/"
