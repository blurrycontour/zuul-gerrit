- hosts: all
  tasks:
    - name: Collect console log.
      synchronize:
        dest: "{{ zuul.launcher.log_root }}"
        mode: pull
        src: "/tmp/console.log"

    - name: Collect tox logs.
      include_role:
        name: run-tox
      vars:
        run_tox_eventlist: "{{ item }}"
        run_tox_task_manager: post
      with_items:
        - coverage
        - pep8
        - py27
      ignore_errors: yes

    - name: publish tox logs.
      copy:
        dest: "/opt/zuul-logs/{{ zuul.uuid}}"
        src: "{{ zuul.launcher.log_root }}/"
      delegate_to: 127.0.0.1
