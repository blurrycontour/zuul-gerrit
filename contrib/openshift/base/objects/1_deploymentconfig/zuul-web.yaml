- kind: DeploymentConfig
  apiVersion: v1
  metadata:
    name: zuul-web
  spec:
    strategy:
      type: Rolling
      rollingParams:
        updatePeriodSeconds: 1
        intervalSeconds: 1
        timeoutSeconds: 60
        maxUnavailable: 25%
        maxSurge: 25%
    triggers:
      - type: ConfigChange
    replicas: 2
    test: false
    template:
      metadata:
        labels:
          app: zuul-web
      spec:
        serviceAccountName: anyuid
        nodeSelector:
          region: primary
        containers:
          - name: zuul-web
            ports:
              - containerPort: 9000
                protocol: TCP
            volumeMounts:
              - name: zuul-base
                mountPath: /etc/zuul
                readOnly: true

              # certificates for gearman
              - name: gearman-client-certificate
                mountPath: /etc/ssl/gearman-client
                readOnly: true

            resources:
              requests:
                cpu: 50m
                memory: 100Mi
              limits:
                cpu: 500m
                memory: 128Mi

        volumes:
          - name: zuul-base
            configMap:
              name: zuul-base
              items:
                - key: zuul.conf
                  path: zuul.conf

          # gearman certificates
          - name: gearman-client-certificate
            secret:
              secretName: gearman-client-certificate
