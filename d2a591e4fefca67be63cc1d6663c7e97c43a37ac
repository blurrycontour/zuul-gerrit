{
  "comments": [
    {
      "key": {
        "uuid": "7a30e71d_24aa0779",
        "filename": "zuul/model.py",
        "patchSetId": 15
      },
      "lineNbr": 894,
      "author": {
        "id": 27952
      },
      "writtenOn": "2021-06-11T06:52:50Z",
      "side": 1,
      "message": "I just took a look at this and it looks like both parameters used in the _getPausedParentProvider() call on the NodeRequest.__init__() method above. So I don\u0027t think we can remove them easily.\n\nI was just asking myself if this paused provider calculation is something that should/must be done inside the model class itself or if that is something we could also do outside of this class when the NodeRequest is created. In this case we could get rid of those two parameters and only have to provide the provider.",
      "revId": "d2a591e4fefca67be63cc1d6663c7e97c43a37ac",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "afa848f6_20a10a35",
        "filename": "zuul/model.py",
        "patchSetId": 15
      },
      "lineNbr": 894,
      "author": {
        "id": 1
      },
      "writtenOn": "2021-06-13T14:35:51Z",
      "side": 1,
      "message": "Yes, that\u0027s a good idea.  It could be moved to the manager in provisionNodes.",
      "revId": "d2a591e4fefca67be63cc1d6663c7e97c43a37ac",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f1d3e015_251d9877",
        "filename": "zuul/model.py",
        "patchSetId": 15
      },
      "lineNbr": 894,
      "author": {
        "id": 27952
      },
      "writtenOn": "2021-06-14T05:53:57Z",
      "side": 1,
      "message": "Ok, then I will do this in a follow-up change",
      "parentUuid": "afa848f6_20a10a35",
      "revId": "d2a591e4fefca67be63cc1d6663c7e97c43a37ac",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "c312ae8d_8666a060",
        "filename": "zuul/model.py",
        "patchSetId": 15
      },
      "lineNbr": 894,
      "author": {
        "id": 27952
      },
      "writtenOn": "2021-06-14T07:13:41Z",
      "side": 1,
      "message": "It seems to be a little more complicated: The pausedParent() call is also used in the priority property of the node request, which means we can\u0027t simply move this part to the pipeline manager. In addition to that the NodesProvisionedEvent handling (Scheduler._doNodesProvisionedEvent) is also relying on the build_set and job being set on the node request. The latter one could be solved by just storing the build_set_uuid and job_name on the node request and iterate over all queue items to find the matching build_set (which we also do for the result events that are stored in ZK by now).",
      "parentUuid": "f1d3e015_251d9877",
      "revId": "d2a591e4fefca67be63cc1d6663c7e97c43a37ac",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5c30dfc5_41147358",
        "filename": "zuul/model.py",
        "patchSetId": 15
      },
      "lineNbr": 894,
      "author": {
        "id": 1
      },
      "writtenOn": "2021-06-21T17:22:21Z",
      "side": 1,
      "message": "For the first part: how about making priority an input value for the constructor and moving the priority calculation to provisionNodes in the manager?\n\nFor the second part: I think we\u0027ll need to do that eventually anyway for multi-schedulers.",
      "revId": "d2a591e4fefca67be63cc1d6663c7e97c43a37ac",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "3c88dca0_a596c39c",
        "filename": "zuul/nodepool.py",
        "patchSetId": 15
      },
      "lineNbr": 181,
      "author": {
        "id": 1
      },
      "writtenOn": "2021-06-10T23:54:51Z",
      "side": 1,
      "message": "This (and the other methods) really should take a Build instance instead of AnsibleJob, but we don\u0027t have builds in ZK yet.\n\nI don\u0027t think AnsibleJob is used anywhere outside of the executor, and it would be nice to keep it that way; it\u0027s complicated enough without trying to serve other use cases.  Can you either switch this to take a bunch of individual arguments, or add a TODO to switch to using Build when it\u0027s available?",
      "revId": "d2a591e4fefca67be63cc1d6663c7e97c43a37ac",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "75bd5332_788fea6b",
        "filename": "zuul/nodepool.py",
        "patchSetId": 15
      },
      "lineNbr": 181,
      "author": {
        "id": 27952
      },
      "writtenOn": "2021-06-11T06:47:45Z",
      "side": 1,
      "message": "I\u0027ve added a TODO. I found that a little more appropriate since we would otherwise have to substitute the build/ansible_job parameter with 5 other parameters and move the logic to get those parameters out into the caller method.",
      "parentUuid": "3c88dca0_a596c39c",
      "revId": "d2a591e4fefca67be63cc1d6663c7e97c43a37ac",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "593eacb4_f99b9920",
        "filename": "zuul/nodepool.py",
        "patchSetId": 15
      },
      "lineNbr": 421,
      "author": {
        "id": 1
      },
      "writtenOn": "2021-06-10T23:54:51Z",
      "side": 1,
      "message": "It might be better to call this method \"checkNodeRequest\" since it doesn\u0027t actually accept anything; it\u0027s mostly a bunch of sanity checks (or possibly a resubmit).  That may help avoid confusions since \"accepting\" is a pretty well defined concept in the nodepool protocol.",
      "revId": "d2a591e4fefca67be63cc1d6663c7e97c43a37ac",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "6d3014c2_f3f8438f",
        "filename": "zuul/nodepool.py",
        "patchSetId": 15
      },
      "lineNbr": 421,
      "author": {
        "id": 27952
      },
      "writtenOn": "2021-06-11T06:47:45Z",
      "side": 1,
      "message": "Sounds reasonable. Done",
      "parentUuid": "593eacb4_f99b9920",
      "revId": "d2a591e4fefca67be63cc1d6663c7e97c43a37ac",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543",
      "unresolved": false
    }
  ]
}