- nodeset:
    name: zuul-functional
    nodes:
      - name: controller
        label: ubuntu-xenial
      - name: node1
        label: ubuntu-xenial
      - name: node2
        label: ubuntu-xenial
    groups:
      - name: node
        nodes:
          - node1
          - node2

- job:
    name: zuul-stream-functional
    parent: multinode
    nodeset: zuul-functional
    pre-run: playbooks/zuul-stream/pre.yaml
    run: playbooks/zuul-stream/functional.yaml
    post-run:
      - playbooks/zuul-stream/post.yaml
      - playbooks/zuul-stream/post-ara.yaml
    required-projects:
      - openstack/ara
    files:
      - zuul/ansible/callback/.*
      - playbooks/zuul-stream/.*

- job:
    name: zuul-tox-py35-ansible-devel
    parent: tox-py35
    description: |
      Run zuul's tests against tip of ansible's devel branch
    voting: false
    vars:
      zuul_work_dir: src/git.openstack.org/openstack-infra/zuul
      tox_install_siblings: true
    required-projects:
      - name: ansible/ansible
        override-branch: devel
      - name: openstack-infra/zuul
        override-branch: feature/zuulv3

- project:
    name: openstack-infra/zuul
    check:
      jobs:
        - build-openstack-sphinx-docs:
            irrelevant-files:
              - zuul/cmd/migrate.py
              - playbooks/zuul-migrate/.*
            vars:
              sphinx_python: python3
        - tox-cover:
            irrelevant-files:
              - zuul/cmd/migrate.py
              - playbooks/zuul-migrate/.*
            voting: false
        - tox-pep8
        - tox-py35:
            irrelevant-files:
              - zuul/cmd/migrate.py
              - playbooks/zuul-migrate/.*
        - zuul-stream-functional
        - zuul-tox-py35-ansible-devel
    gate:
      jobs:
        - build-openstack-sphinx-docs:
            irrelevant-files:
              - zuul/cmd/migrate.py
              - playbooks/zuul-migrate/.*
            vars:
              sphinx_python: python3
        - tox-pep8
        - tox-py35:
            irrelevant-files:
              - zuul/cmd/migrate.py
              - playbooks/zuul-migrate/.*
        - zuul-stream-functional
    post:
      jobs:
        - publish-openstack-sphinx-docs-infra-python3
        - publish-openstack-python-branch-tarball
