{
  "comments": [
    {
      "key": {
        "uuid": "3f044301_12ba1c09",
        "filename": "zuul/executor/server.py",
        "patchSetId": 2
      },
      "lineNbr": 91,
      "author": {
        "id": 7191
      },
      "writtenOn": "2017-05-10T04:45:53Z",
      "side": 1,
      "message": "looking through the ssh-agent man page there\u0027s a few things I think we can use. \n\nIf you use -D (no-daemon) and save the return like: \n\nself.agent \u003d subprocess.Popen([\u0027ssh-agent\u0027, \u0027-D\u0027])\n\nyou can self.agent.kill() later.\n\nAlso not sure if this is better, but you can do -a to specify the bind address rather than discover it afterwards so like,\n\n-a $JOBDIR/ssh-agent\n\nagain and save that rather than query the output.",
      "revId": "5a6f0c7a2285a288775b43a6a167ca21da7619db",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "3f044301_6653bb18",
        "filename": "zuul/executor/server.py",
        "patchSetId": 2
      },
      "lineNbr": 91,
      "author": {
        "id": 6488
      },
      "writtenOn": "2017-05-11T21:35:05Z",
      "side": 1,
      "message": "I like it. Especially since we can just put the socket in the job dir and get it inside the bubblewrap for free.",
      "revId": "5a6f0c7a2285a288775b43a6a167ca21da7619db",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "1f013ff3_aab48f36",
        "filename": "zuul/executor/server.py",
        "patchSetId": 2
      },
      "lineNbr": 91,
      "author": {
        "id": 6488
      },
      "writtenOn": "2017-05-12T18:18:40Z",
      "side": 1,
      "message": "So after playing with this idea, it fell apart a bit in the details. One good reason to use daemon mode is that ssh-agent takes care to create the socket before forking and exiting. So when we use .communicate() below, we know that the socket is ready and it\u0027s safe to return from start(). If we don\u0027t have that, we have to poll the socket file\u0027s existence, or poll the stdout for the printed details, which signals that the socket is ready. Using daemon mode then actually seems simpler.",
      "revId": "5a6f0c7a2285a288775b43a6a167ca21da7619db",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543",
      "unresolved": false
    }
  ]
}