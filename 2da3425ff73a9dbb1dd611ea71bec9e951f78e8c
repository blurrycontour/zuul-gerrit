{
  "comments": [
    {
      "key": {
        "uuid": "007d0105_9b74f1dd",
        "filename": "zuul/manager/__init__.py",
        "patchSetId": 9
      },
      "lineNbr": 1303,
      "author": {
        "id": 16068
      },
      "writtenOn": "2021-09-05T14:31:01Z",
      "side": 1,
      "message": "This introduces a network round trip for all node requests in the pipeline in all pipeline runs (which can be a lot). I think this may have a noticeable impact on scheduling performance in our system.\n\nI think we usually only have to revise the priorities if some item we processed before changed in a way that requires this (I think that\u0027s only dequeued items and failed items in dependent pipelines). We could change processOneItem to return a flag if it did such a change and forward that to the next processOneItem call so we can skip this loop entirely if we don\u0027t need to revise node requests.",
      "revId": "2da3425ff73a9dbb1dd611ea71bec9e951f78e8c",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e201570b_0b8de00e",
        "filename": "zuul/manager/__init__.py",
        "patchSetId": 9
      },
      "lineNbr": 1303,
      "author": {
        "id": 27952
      },
      "writtenOn": "2021-09-06T05:22:36Z",
      "side": 1,
      "message": "AFAIK zk_nodepool.getNodeRequest() uses the local tree cache dictionary, so there shouldn\u0027t be any network roundtrips. This line is the reason we decided to add a tree cache in the first place. But I\u0027m definitely in favour if we could find a way to avoid this loop (and don\u0027t introduce anything too complex somewhere else).",
      "parentUuid": "007d0105_9b74f1dd",
      "revId": "2da3425ff73a9dbb1dd611ea71bec9e951f78e8c",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "88dc587d_6dceb287",
        "filename": "zuul/manager/__init__.py",
        "patchSetId": 9
      },
      "lineNbr": 1303,
      "author": {
        "id": 1
      },
      "writtenOn": "2021-09-06T22:22:28Z",
      "side": 1,
      "message": "Yes, it uses the cache, so this is almost identical to the current code.  I don\u0027t think it\u0027s worth trying to avoid this loop right now.",
      "revId": "2da3425ff73a9dbb1dd611ea71bec9e951f78e8c",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543",
      "unresolved": false
    }
  ]
}